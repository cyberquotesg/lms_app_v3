<ion-header>
    <cq_header [title]="'My Reports'" [displayMenu]="true" [displayNotification]="true" [displayProgress]="pageIsLoading" (onToggleDrawer)="toggleDrawer()" (onGoToNotificationsList)="goToNotificationsList()"></cq_header>
</ion-header>

<ion-content class="cq_my_reports">
    <ion-refresher slot="fixed" [disabled]="!pageStatus" (ionRefresh)="pageRefresh($event.target)">
        <ion-refresher-content pullingText="{{ 'core.pulltorefresh' | translate }}"></ion-refresher-content>
    </ion-refresher>

    <core-loading [hideUntil]="pageStatus">
        <div class="base-background">

        <div class="text-center">
            <ion-slides [options]="pageData.yearsSliderOptions">
                <ion-slide *ngFor="let availableYear of pageData.availableYears" class="mt-36 mb-36">
                    <button class="{{ availableYear == pageData.selectedYear ? 'active' : '' }}" (click)="selectYear(availableYear)">
                        {{ availableYear }}
                    </button>
                </ion-slide>
            </ion-slides>
        </div>

        <ion-slides #pageSlider class="page-slider" [options]="pageData.pageSliderOptions" (ionSlideDidChange)="pageSliderChange()" style="transition: height 0.2s ease 0s;">
            <ion-slide *ngFor="let availableYear of pageData.availableYears" style="display: block;">
                <div *ngIf="pageData[availableYear]">
                    <div class="text-center">
                        <h5 class="mt-0 mb-20 text-center"><b>My Training Hours in {{ availableYear }}</b></h5>
                        
                        <span class="dot mt-8 mb-8">
                            <div class="time-inside-dot second-font">
                                <div class="part">
                                    <div class="number">{{ pageData[availableYear].totalCPDInHours }}</div>
                                    <div class="type">{{ 'core.cqShortHoursSymbol' | translate }}</div>
                                </div>
                                <div class="part">
                                    <div class="number">{{ pageData[availableYear].totalCPDInMinutes }}</div>
                                    <div class="type">{{ 'core.cqShortMinutesSymbol' | translate }}</div>
                                </div>
                            </div>
                        </span>

                        <ion-card *ngIf="isAvailable(pageData[availableYear].chartData)" class="mb-28">
                            <ion-card-content>
                                <cq_chart [type]="pageData.CqConfig.mobile_chart_type" [stacked]="pageData.CqConfig.mobile_chart_stacked" [data]="pageData[availableYear].chartData"></cq_chart>
                            </ion-card-content>
                        </ion-card>
                    </div>

                    <div *ngIf="!isEmpty(pageData[availableYear].courses)" class="pl-cs pr-cs pt-12 pb-0">
                        <cq_filter [filterMultiple]="pageData.filterMultiple" [includeEmptyOptionForAll]="true" (onFilterChange)="onFilterChange($event)"></cq_filter>
                    </div>

                    <div *ngIf="!isEmpty(pageData[availableYear].coursesFiltered)">
                        <div *ngFor="let courseType of pageData.courseTypes.array">
                            <div *ngIf="isAvailable(pageData[availableYear].perCourseType[courseType.jsIdentifier].courses)">
                                <div class="main-font text-left" class="pl-20 pr-20 mt-28 text-left" style="font-size: 16px;">
                                    {{ courseType.name }}

                                    {{ pageData[availableYear].perCourseType[courseType.jsIdentifier].hours }}
                                    <span *ngIf="pageData[availableYear].perCourseType[courseType.jsIdentifier].hours == 1">Hour</span>
                                    <span *ngIf="pageData[availableYear].perCourseType[courseType.jsIdentifier].hours != 1">Hours</span>

                                    <span *ngIf="pageData[availableYear].perCourseType[courseType.jsIdentifier].minutes > 0">
                                        {{ pageData[availableYear].perCourseType[courseType.jsIdentifier].minutes }}
                                        <span *ngIf="pageData[availableYear].perCourseType[courseType.jsIdentifier].minutes == 1">Minute</span>
                                        <span *ngIf="pageData[availableYear].perCourseType[courseType.jsIdentifier].minutes != 1">Minutes</span>
                                    </span>

                                    <small *ngIf="courseType.includetocpdhours != 1" style="display: block;">Excluded from CPD Hours</small>

                                    <div style="background: purple;height: 4px;border-radius: 0px 2px 2px 0px;margin-top: 12px;margin-left: -20px;"></div>
                                </div>
                        
                                <!-- warning! masih pake warna purle -->
                                <ion-card *ngFor="let course of pageData[availableYear].perCourseType[courseType.jsIdentifier].courses">
                                    <ion-card-content>
                                        <div class="card-single-list has-left">
                                            <div class="csl-left">
                                                <!-- warning! masih belum pakai beautiful number -->
                                                <span class="dot small d-block elevation-1 {{ course.detailedUserStatusInSession != 'accredited' || courseType.includetocpdhours != 1 ? 'plain' : '' }}">{{course.brokendownCpdHours.hours}}{{ 'core.cqShortHoursSymbol' | translate }}<br />{{course.brokendownCpdHours.minutes}}{{ 'core.cqShortMinutesSymbol' | translate }}</span>
                                            </div>
                                            <div class="csl-center text-left">
                                                <h2 class="mt-4 mb-5">{{course.name || course.coursename}}</h2>
                                                <p class="no-break">Completion Date: {{course.end_date_text}}</p>
                                            </div>
                                            <div class="cq-tag-wrapper text-left pt-8" style="clear: both;">
                                                <span *ngIf="course.media == 'online'" class="cq-tag">E-Learning</span>
                                                <span *ngIf="course.media == 'offline'" class="cq-tag">Classroom Training</span>

                                                <span *ngIf="course.detailedUserStatusInSession != 'accredited'" class="cq-tag red">{{ course.detailedUserStatusInSessionText }}</span>
                                                <span *ngIf="course.detailedUserStatusInSession == 'accredited'" class="cq-tag green">
                                                    <ion-icon name="checkmark-circle" style="vertical-align: text-bottom; padding-right: 2px;"></ion-icon>
                                                    {{ course.detailedUserStatusInSessionText }}
                                                </span>

                                                <span *ngIf="course.compulsory === true || course.compulsory === 1 || course.compulsory === '1'" class="cq-tag orange">Compulsory</span>
                                                <span *ngIf="course.typeText || course.courseTypeText" class="cq-tag dark-grey">{{ course.typeText || course.courseTypeText }}</span>
                                                <span *ngIf="course.categoryname || course.categoryName" class="cq-tag dark-grey">{{ course.categoryname || course.categoryName }}</span>
                                            </div>
                                        </div>
                                    </ion-card-content>
                                </ion-card>
                            </div>
                        </div>
                    </div>

                    <cq_empty [empty]="isEmpty(pageData[availableYear].coursesFiltered)"></cq_empty>
                </div>

                <div *ngIf="!pageData[availableYear]">
                    <div class="mt-48 pt-48">
                        <ion-spinner role="progressbar"></ion-spinner>
                    </div>
                </div>
            </ion-slide>
        </ion-slides>

        </div>
    </core-loading>
</ion-content>
